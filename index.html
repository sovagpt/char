<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animalympics - Vote for Your Champion</title>
    
    <!-- Custom Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            background: #0A0B0D;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        /* Subtle gradient background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 119, 168, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(255, 185, 103, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Grid pattern overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        .main-container {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Social buttons in top right */
        .social-buttons {
            position: fixed;
            top: 24px;
            right: 24px;
            display: flex;
            gap: 12px;
            z-index: 100;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .social-button {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            overflow: hidden;
            position: relative;
        }

        .social-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .social-button img {
            width: 28px;
            height: 28px;
            object-fit: contain;
            filter: brightness(0.9);
            transition: all 0.3s;
        }

        .social-button:hover img {
            filter: brightness(1.1);
            transform: scale(1.1);
        }

        .social-button.bags-button:hover {
            background: linear-gradient(135deg, rgba(255, 185, 103, 0.15), rgba(255, 119, 168, 0.15));
        }

        .social-button.twitter-button:hover {
            background: rgba(29, 155, 240, 0.15);
        }

        @media (max-width: 768px) {
            .social-buttons {
                top: 16px;
                right: 16px;
            }
            
            .social-button {
                width: 42px;
                height: 42px;
            }
            
            .social-button img {
                width: 24px;
                height: 24px;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo {
            max-width: 400px;
            width: 100%;
            height: auto;
            filter: drop-shadow(0 10px 40px rgba(0,0,0,0.5));
        }

        .tagline {
            font-size: 1.125rem;
            color: #9CA3AF;
            font-weight: 500;
            letter-spacing: -0.02em;
            margin-top: 20px;
        }

        .timer-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px 48px;
            margin-bottom: 48px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        .timer {
            color: #FFFFFF;
            font-family: 'Space Grotesk', monospace;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.02em;
        }

        .timer-label {
            font-size: 0.875rem;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .timer-value {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 32px;
            margin-bottom: 48px;
            padding: 0 20px;
        }

        .animal-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out both;
            position: relative;
        }

        .animal-card:nth-child(1) { animation-delay: 0.1s; }
        .animal-card:nth-child(2) { animation-delay: 0.2s; }
        .animal-card:nth-child(3) { animation-delay: 0.3s; }

        .animal-card:hover {
            transform: translateY(-8px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .animal-card.voted {
            border-color: #FFB967;
            background: rgba(255, 185, 103, 0.05);
        }

        .animal-card.voted::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FFB967 0%, #FF77A8 100%);
        }

        .animal-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .animal-content {
            padding: 32px;
        }

        .animal-type-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #9CA3AF;
            padding: 6px 16px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .animal-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #FFFFFF;
            letter-spacing: -0.02em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .animal-description {
            color: #9CA3AF;
            line-height: 1.6;
            margin-bottom: 24px;
            font-size: 0.95rem;
            min-height: 80px;
        }

        .vote-section {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding-top: 24px;
        }

        .vote-count {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            color: #FFFFFF;
            font-size: 1.125rem;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', monospace;
            letter-spacing: -0.01em;
        }

        .voted .vote-count {
            background: linear-gradient(135deg, rgba(255, 185, 103, 0.1), rgba(255, 119, 168, 0.1));
            border-color: rgba(255, 185, 103, 0.3);
        }

        .vote-button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .vote-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .vote-button:hover::before {
            left: 100%;
        }

        .vote-button:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 185, 103, 0.3);
        }

        .voted .vote-button {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .voted .vote-button::after {
            content: " ✓";
        }

        .more-info-button {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: transparent;
            color: #9CA3AF;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .more-info-button:hover {
            background: rgba(255, 255, 255, 0.03);
            color: #FFFFFF;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .results-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 48px;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }

        .round-winner {
            text-align: center;
            margin-bottom: 40px;
        }

        .winner-label {
            font-size: 0.875rem;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .winner-image {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            object-fit: cover;
            margin: 24px auto;
            border: 3px solid transparent;
            background: linear-gradient(#0A0B0D, #0A0B0D) padding-box,
                        linear-gradient(135deg, #FFB967 0%, #FF77A8 100%) border-box;
        }

        .winner-name {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.03em;
        }

        .winner-votes {
            font-size: 1.25rem;
            color: #9CA3AF;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .winner-description {
            color: #6B7280;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto 24px;
        }

        .next-round-btn {
            width: 100%;
            padding: 18px;
            margin-top: 32px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .next-round-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(255, 185, 103, 0.3);
        }

        .history {
            margin-top: 48px;
            padding-top: 48px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history h3 {
            color: #FFFFFF;
            margin-bottom: 24px;
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .history-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .history-animal {
            display: flex;
            align-items: center;
            gap: 16px;
            color: #FFFFFF;
            font-weight: 600;
        }

        .history-image {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            object-fit: cover;
        }

        .history-round {
            font-weight: 600;
            color: #FFB967;
            font-family: 'Space Grotesk', monospace;
        }

        /* Winners Menu Styles */
        .winners-menu {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 1000;
            max-width: 420px;
        }

        .winners-toggle {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #FFFFFF;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winners-toggle:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .winners-badge {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .winners-panel {
            position: absolute;
            bottom: 70px;
            left: 0;
            background: rgba(17, 18, 23, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            width: 420px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .winners-panel.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .winners-panel-header {
            background: linear-gradient(135deg, rgba(255, 185, 103, 0.1), rgba(255, 119, 168, 0.1));
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 24px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .winners-panel-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #FFFFFF;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winners-list {
            padding: 16px;
        }

        .winner-entry {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .winner-entry:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .winner-entry-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .winner-entry-image {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            object-fit: cover;
        }

        .winner-entry-info {
            flex: 1;
        }

        .winner-entry-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 4px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winner-entry-round {
            color: #9CA3AF;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .winner-entry-votes {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.875rem;
            font-family: 'Space Grotesk', monospace;
        }

        .winner-entry-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .winner-entry-competitors {
            font-size: 0.875rem;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .competitor-name {
            display: inline-block;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 4px 8px;
            border-radius: 6px;
            margin: 2px;
            font-size: 0.75rem;
            color: #9CA3AF;
        }

        .winner-entry-time {
            font-size: 0.75rem;
            color: #6B7280;
            margin-top: 8px;
        }

        .no-winners {
            text-align: center;
            padding: 40px;
            color: #6B7280;
        }

        /* Loading states */
        .loading {
            color: #9CA3AF;
            font-size: 1.25rem;
            text-align: center;
            padding: 60px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .logo {
                max-width: 300px;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
                padding: 0;
            }
            
            .animal-card {
                max-width: 100%;
            }

            .winners-menu {
                left: 12px;
                bottom: 12px;
            }
            
            .winners-panel {
                width: calc(100vw - 40px);
                max-width: 420px;
            }

            .winner-name {
                font-size: 2rem;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
        }
    </style>
</head>
<body>
    <!-- Social buttons -->
    <div class="social-buttons">
        <a href="https://bags.fm" target="_blank" rel="noopener noreferrer" class="social-button bags-button">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/689a9b238c72e83b1999da45_6883a492438dc32acb24bd8a_userlmn_e14161accb7674f25f0dd6fc1ec4e340%20(1).png" alt="bags.fm">
        </a>
        <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" class="social-button twitter-button">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/688401711f7c1c43849d13a6_HIMACZhOn7YJ71dTu-actor-2fSSfmZramPBO73OK-iBihnF3pbp-dexpng%20(2).png" alt="Twitter/X">
        </a>
    </div>

    <div class="main-container">
        <div class="header">
            <div class="logo-container">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/689d3129ec968a3a68837590_Animalympics-14-08-2025.png" alt="Animalympics" class="logo">
            </div>
            <p class="tagline">Vote for your champion • New round every 10 minutes</p>
        </div>

        <div class="timer-container">
            <div class="timer">
                <span class="timer-label">Next Round</span>
                <span class="timer-value" id="timer">10:00</span>
            </div>
        </div>

        <div id="voting-area">
            <div class="cards-container" id="cards-container"></div>
        </div>

        <div id="results-area" style="display: none;">
            <div class="results-container">
                <div class="round-winner">
                    <div class="winner-label">Champion of Round <span id="round-number"></span></div>
                    <img class="winner-image" id="winner-image" src="" alt="">
                    <div class="winner-name" id="winner-name"></div>
                    <div class="winner-votes" id="winner-votes"></div>
                    <div class="winner-description" id="winner-description"></div>
                </div>
                <button class="next-round-btn" onclick="startNewRound()">Next Round</button>
                <div class="history" id="history">
                    <h3>Previous Champions</h3>
                </div>
            </div>
        </div>

        <!-- Winners Menu -->
        <div class="winners-menu">
            <button class="winners-toggle" onclick="toggleWinnersMenu()">
                Hall of Fame
                <span class="winners-badge" id="winners-count">0</span>
            </button>
            <div class="winners-panel" id="winners-panel">
                <div class="winners-panel-header">
                    <div class="winners-panel-title">Champions Archive</div>
                </div>
                <div class="winners-list" id="winners-list">
                    <div class="no-winners">No champions yet. Cast your votes!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCzcVwv8qs3eUny79eLIsqPu3cyybbDnuA",
            authDomain: "animal-voting.firebaseapp.com",
            databaseURL: "https://animal-voting-default-rtdb.firebaseio.com",
            projectId: "animal-voting",
            storageBucket: "animal-voting.firebasestorage.app",
            messagingSenderId: "606364151440",
            appId: "1:606364151440:web:ac16809e27f242e77fb215",
            measurementId: "G-WXCXYQH30F"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Animal data pool
        const animalPool = [
            {
                name: "Batman",
                type: "Cat",
                description: "A mysterious and charming feline who loves to patrol the sanctuary at night. Despite his tough name, he's incredibly gentle.",
                image: "https://gifts.bestfriends.org/collections/sponsorships/products/sponsor-batman",
               link: "https://gifts.bestfriends.org/products/sponsor-batman"
           },
           {
               name: "Blueberry",
               type: "Rabbit",
               description: "This adorable bunny got her name from her love of fresh berries. She's playful and loves to hop around in the grass.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/234603_Blueberry_SHOPIFY_MAIN_2048x2048_b0ef29e5-3f5e-4332-a2f7-1aeb48405ec3_360x.jpg?v=1689742095",
               link: "https://gifts.bestfriends.org/products/sponsor-blueberry"
           },
           {
               name: "Brussels Sprout",
               type: "Guinea Pig",
               description: "Don't let the veggie name fool you - this little guy has a huge personality and loves cuddles more than anything.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/BrusselsSprout_246117_Dec2024_MainShopify_Shopify_2048x2048_2210846d-f1c0-4480-89ed-34a74477691f_360x.jpg?v=1735952210",
               link: "https://gifts.bestfriends.org/products/sponsor-brussels-sprout"
           },
           {
               name: "Bryce",
               type: "Dog",
               description: "A loyal companion who came to the sanctuary after being found as a stray. He's learning to trust again and loves belly rubs.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/222898-SponsorshipAnimals_2048x2048_dp7_360x.jpg?v=1645719418",
               link: "https://gifts.bestfriends.org/products/sponsor-bryce"
           },
           {
               name: "Caboodle",
               type: "Dog",
               description: "Kit's brother who has a neurological condition but doesn't let it slow him down. Loves playing with friends and rolling in snow.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/010354_SponsorshipAnimalsForShopify_PreviewImage_Caboodle_LL_360x.jpg?v=1617924697",
               link: "https://gifts.bestfriends.org/products/sponsor-caboodle"
           },
           {
               name: "Cameo",
               type: "Pig",
               description: "A gentle, affectionate pig who loves mud baths and lazy afternoons. Found as a stray in 2013, now living her best life.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/200986_NewSponsorshipAnimals_2048x2048_Cameo_LL_360x.jpg?v=1621001790",
               link: "https://gifts.bestfriends.org/products/sponsor-cameo"
           },
           {
               name: "Captain",
               type: "Dog",
               description: "Leading his pack with courage and kindness. This brave pup overcame a difficult past and now helps other dogs feel safe.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/Captain_SHOPIFY_MAIN_360x.jpg?v=1702778010",
               link: "https://gifts.bestfriends.org/products/sponsor-captain"
           },
           {
               name: "Clancy",
               type: "Cat",
               description: "An Irish charmer with emerald eyes and a purr that could melt hearts. Loves sunny windowsills and head scratches.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/Clancy_SHOPIFY_MAIN_ECARD_2048x2048_40452241-688b-44c5-b4b7-6f89e2d70d18_360x.jpg?v=1702778122",
               link: "https://gifts.bestfriends.org/products/sponsor-clancy"
           },
           {
               name: "Dean Martin",
               type: "Dog",
               description: "Smooth as his namesake, this crooner loves to 'sing' along when music plays. A true entertainer at heart.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/DeanMartin_246117_MainShopify_Shopify_2048x2048_3763634b-3c0a-4e0d-87e2-e66f18eb58ac_360x.jpg?v=1735951137",
               link: "https://gifts.bestfriends.org/products/sponsor-dean-martin"
           },
           {
               name: "Dorian",
               type: "Dog",
               description: "Dorian is the picture of personality: class clown, clever learner, and best friend to his dog friends all rolled into one.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/Dorian_246117_MainShopify_Shopify_2048x2048_32859bd8-21bd-42db-a1df-de70ba51e979_360x.jpg?v=1735949381",
               link: "https://gifts.bestfriends.org/products/sponsor-hudson"
           },
           {
               name: "Jelly Bean",
               type: "Cat",
               description: "A clever kitty with a mild neurological condition and deafness, but she's learned to navigate the world in her own special way.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/223773-JellyBean_2048x2048_LC5_360x.jpg?v=1667926441",
               link: "https://gifts.bestfriends.org/products/sponsor-jelly-bean"
           },
           {
               name: "Jewel",
               type: "Horse",
               description: "A precious gem of the sanctuary, this gentle mare loves carrots and gentle brushing sessions with volunteers.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/222898-SponsorshipAnimals_2048x2048_dp8_360x.jpg?v=1645741250",
               link: "https://gifts.bestfriends.org/products/sponsor-jewel"
           },
           {
               name: "Kit",
               type: "Dog",
               description: "Sweet as can be despite her neurological challenges. Loves playing with dog friends and has an incredible spirit.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/010354_SponsorshipAnimalsForShopify_PreviewImage_Kit_LL_360x.jpg?v=1617925992",
               link: "https://gifts.bestfriends.org/products/sponsor-kit"
           },
           {
               name: "Koda",
               type: "Cat",
               description: "Quirky and affectionate, loves perching on shoulders and zooming through cat tunnels. Not a fan of loud noises but loves hugs.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/211584_NewSponsorshipAnimals_2048x2048_Koda_LL_360x.jpg?v=1618949134",
               link: "https://gifts.bestfriends.org/products/sponsor-koda"
           },
           {
               name: "Evelyn",
               type: "Cat",
               description: "She has Manx syndrome, a condition prevalent in tailless cats that causes a shortening of the spine.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/234603_Evelyn_SHOPIFY_MAIN_2048x2048_eadc4590-a5c0-46bd-9246-4fc175176549_360x.jpg?v=1689788749",
               link: "https://gifts.bestfriends.org/products/sponsor-reindeer"
           },
           {
               name: "Snickers",
               type: "Horse",
               description: "Sweet as the candy bar she's named after. This beautiful horse loves trail rides and making new human friends.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/223773-Snickers_2048x2048_LC_360x.jpg?v=1667922055",
               link: "https://gifts.bestfriends.org/products/sponsor-snickers"
           },
           {
               name: "Tony",
               type: "Horse",
               description: "A gentle giant with a heart of gold. Tony loves apples and has become a favorite among sanctuary visitors.",
               image: "https://gifts.bestfriends.org/cdn/shop/products/200258_2020MothersDayCampaign_Shopify2048x2048_LL3_360x.jpg?v=1617926320",
               link: "https://gifts.bestfriends.org/products/sponsor-tony"
           },
           {
               name: "Precious",
               type: "Cat",
               description: "She was found matted and alone in an alley, with a BB in her right leg and a larger bullet in her chest that had fractured one of her ribs as well as her spine, leaving her partially paralyzed and incontinent.",
               image: "https://gifts.bestfriends.org/cdn/shop/files/Precious_SHOPIFY_MAIN_360x.jpg?v=1702790493",
               link: "https://gifts.bestfriends.org/products/sponsor-bossco"
           }
       ];

       let currentAnimals = [];
       let usedAnimals = [];
       let votes = {};
       let timer = 600; // 10 minutes in seconds
       let timerInterval;
       let roundNumber = 1;
       let winners = [];
       let hasVoted = false;
       let currentRoundRef = null;
       let allRoundData = []; // Store complete round data
       let votesListener = null;
       let isInitializing = true;

       // Generate a unique user ID and store in localStorage
       function getUserId() {
           let userId = localStorage.getItem('userId');
           if (!userId) {
               userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
               localStorage.setItem('userId', userId);
           }
           return userId;
       }

       const userId = getUserId();

       function toggleWinnersMenu() {
           const panel = document.getElementById('winners-panel');
           panel.classList.toggle('active');
       }

       // Close winners menu when clicking outside
       document.addEventListener('click', function(event) {
           const menu = document.querySelector('.winners-menu');
           const panel = document.getElementById('winners-panel');
           if (!menu.contains(event.target) && panel.classList.contains('active')) {
               panel.classList.remove('active');
           }
       });

       function getRandomAnimals(seed) {
           // Use a seeded random to ensure same animals for all users
           const seedRandom = (seed) => {
               const x = Math.sin(seed) * 10000;
               return x - Math.floor(x);
           };
           
           // Create a deterministic shuffle based on the seed
           const shuffled = [...animalPool].sort((a, b) => {
               const seedA = seed + a.name.charCodeAt(0);
               const seedB = seed + b.name.charCodeAt(0);
               return seedRandom(seedA) - seedRandom(seedB);
           });
           
           return shuffled.slice(0, 3);
       }

       function createAnimalCard(animal, index) {
           const card = document.createElement('div');
           card.className = 'animal-card';
           card.id = `animal-${index}`;
           
           // Check if user has already voted
           const userVoteKey = `voted_round_${roundNumber}`;
           const userHasVoted = localStorage.getItem(userVoteKey);
           if (userHasVoted && parseInt(userHasVoted) === index) {
               card.classList.add('voted');
           }
           
           card.innerHTML = `
               <img src="${animal.image}" alt="${animal.name}" class="animal-image">
               <div class="animal-content">
                   <span class="animal-type-badge">${animal.type}</span>
                   <div class="animal-name">${animal.name}</div>
                   <div class="animal-description">${animal.description}</div>
                   <div class="vote-section">
                       <div class="vote-count">Votes: <span id="votes-${index}">0</span></div>
                       <button class="vote-button" onclick="vote(${index})">Vote for ${animal.name}</button>
                       <a href="${animal.link}" target="_blank" rel="noopener noreferrer" class="more-info-button">
                           Learn More
                       </a>
                   </div>
               </div>
           `;
           
           return card;
       }

       function vote(index) {
           const userVoteKey = `voted_round_${roundNumber}`;
           const userHasVoted = localStorage.getItem(userVoteKey);
           
           if (userHasVoted !== null) {
               alert("You've already voted in this round! Wait for the next round to vote again.");
               return;
           }
           
           // Update Firebase
           if (currentRoundRef) {
               currentRoundRef.child('votes').child(index).transaction((currentVotes) => {
                   return (currentVotes || 0) + 1;
               });
               
               // Record user's vote
               currentRoundRef.child('voters').child(userId).set({
                   votedFor: index,
                   timestamp: Date.now()
               });
           }
           
           // Mark as voted locally
           localStorage.setItem(userVoteKey, index);
           
           document.querySelectorAll('.animal-card').forEach(card => {
               card.classList.remove('voted');
           });
           document.getElementById(`animal-${index}`).classList.add('voted');
       }

       function updateTimer() {
           const minutes = Math.floor(timer / 60);
           const seconds = timer % 60;
           document.getElementById('timer').textContent = 
               `${minutes}:${seconds.toString().padStart(2, '0')}`;
           
           if (timer <= 0) {
               checkForNewRound();
           } else {
               timer--;
           }
       }

       function setupVotesListener() {
           if (votesListener) {
               votesListener.off();
           }
           
           if (currentRoundRef) {
               votesListener = currentRoundRef.child('votes').on('value', (snapshot) => {
                   const votesData = snapshot.val() || {};
                   votes = votesData;
                   
                   // Update all vote counts
                   for (let i = 0; i < 3; i++) {
                       const voteElement = document.getElementById(`votes-${i}`);
                       if (voteElement) {
                           voteElement.textContent = votesData[i] || 0;
                       }
                   }
               });
           }
       }

       function displayRound(roundData) {
           if (!roundData) return;
           
           roundNumber = roundData.roundNumber;
           currentAnimals = roundData.animals;
           
           // Calculate remaining time
           const now = Date.now();
           const roundEndTime = roundData.startTime + (10 * 60 * 1000); // 10 minutes
           const remainingMs = Math.max(0, roundEndTime - now);
           timer = Math.floor(remainingMs / 1000);
           
           // Clear existing timer
           if (timerInterval) {
               clearInterval(timerInterval);
           }
           
           // Display voting area
           document.getElementById('voting-area').style.display = 'block';
           document.getElementById('results-area').style.display = 'none';
           
           // Create cards
           const container = document.getElementById('cards-container');
           container.innerHTML = '';
           currentAnimals.forEach((animal, index) => {
               container.appendChild(createAnimalCard(animal, index));
           });
           
           // Setup votes listener
           setupVotesListener();
           
           // Start timer
           timerInterval = setInterval(updateTimer, 1000);
       }

       function showResults(winner) {
           document.getElementById('voting-area').style.display = 'none';
           document.getElementById('results-area').style.display = 'block';
           
           document.getElementById('round-number').textContent = roundNumber;
           document.getElementById('winner-image').src = winner.image;
           document.getElementById('winner-name').textContent = winner.name;
           document.getElementById('winner-votes').textContent = 
               `${winner.votes} vote${winner.votes !== 1 ? 's' : ''}`;
           document.getElementById('winner-description').textContent = winner.description;
           
           updateHistory();
       }

       function updateHistory() {
           database.ref('winners').orderByChild('timestamp').limitToLast(5).once('value', (snapshot) => {
               const historyContainer = document.getElementById('history');
               historyContainer.innerHTML = '<h3>Previous Champions</h3>';
               
               const winnersData = [];
               snapshot.forEach((child) => {
                   winnersData.push(child.val());
               });
               
               winnersData.reverse().forEach(winner => {
                   const item = document.createElement('div');
                   item.className = 'history-item';
                   item.innerHTML = `
                       <div class="history-animal">
                           <img src="${winner.image}" alt="${winner.name}" class="history-image">
                           <span>${winner.name} (${winner.type})</span>
                       </div>
                       <span class="history-round">Round ${winner.round} • ${winner.votes} votes</span>
                   `;
                   historyContainer.appendChild(item);
               });
           });
       }

       function updateWinnersMenu() {
           database.ref('winners').orderByChild('timestamp').once('value', (snapshot) => {
               const winnersData = [];
               snapshot.forEach((child) => {
                   winnersData.push(child.val());
               });
               
               // Update badge count
               document.getElementById('winners-count').textContent = winnersData.length;
               
               // Update winners list
               const listContainer = document.getElementById('winners-list');
               
               if (winnersData.length === 0) {
                   listContainer.innerHTML = '<div class="no-winners">No champions yet. Cast your votes!</div>';
                   return;
               }
               
               listContainer.innerHTML = '';
               
               // Show all rounds in reverse order (most recent first)
               winnersData.reverse().forEach(winner => {
                   const entry = document.createElement('div');
                   entry.className = 'winner-entry';
                   
                   entry.innerHTML = `
                       <div class="winner-entry-header">
                           <img src="${winner.image}" alt="${winner.name}" class="winner-entry-image">
                           <div class="winner-entry-info">
                               <div class="winner-entry-name">${winner.name}</div>
                               <div class="winner-entry-round">Round ${winner.round}</div>
                           </div>
                           <div class="winner-entry-votes">${winner.votes} votes</div>
                       </div>
                   `;
                   
                   listContainer.appendChild(entry);
               });
           });
       }

       function checkForNewRound() {
           // Check if there's an active round
           database.ref('currentRound').once('value', (snapshot) => {
               const currentRoundData = snapshot.val();
               
               if (!currentRoundData || currentRoundData.status === 'completed') {
                   // Need to start a new round
                   if (isInitializing || currentRoundData?.status === 'completed') {
                       // Only create new round if we're initializing or the previous round is complete
                       createNewRound();
                   }
               } else {
                   // Display the existing round
                   currentRoundRef = database.ref('rounds').child(currentRoundData.roundId);
                   currentRoundRef.once('value', (roundSnapshot) => {
                       displayRound(roundSnapshot.val());
                   });
               }
               
               isInitializing = false;
           });
       }

       function createNewRound() {
           // Get the next round number
           database.ref('stats/lastRoundNumber').transaction((current) => {
               return (current || 0) + 1;
           }, (error, committed, snapshot) => {
               if (committed) {
                   const newRoundNumber = snapshot.val();
                   
                   // Generate animals with seed based on round number
                   const selectedAnimals = getRandomAnimals(newRoundNumber * 12345);
                   
                   // Create new round
                   const newRoundRef = database.ref('rounds').push();
                   const roundData = {
                       roundNumber: newRoundNumber,
                       roundId: newRoundRef.key,
                       startTime: Date.now(),
                       status: 'active',
                       animals: selectedAnimals,
                       votes: {},
                       voters: {}
                   };
                   
                   newRoundRef.set(roundData);
                   
                   // Update current round pointer
                   database.ref('currentRound').set({
                       roundId: newRoundRef.key,
                       roundNumber: newRoundNumber,
                       startTime: Date.now(),
                       status: 'active'
                   });
                   
                   // Set up auto-end after 10 minutes
                   setTimeout(() => {
                       endCurrentRound(newRoundRef.key);
                   }, 10 * 60 * 1000);
                   
                   currentRoundRef = newRoundRef;
                   displayRound(roundData);
               }
           });
       }

       function endCurrentRound(roundId) {
           const roundRef = database.ref('rounds').child(roundId);
           
           roundRef.once('value', (snapshot) => {
               const roundData = snapshot.val();
               if (!roundData || roundData.status === 'completed') return;
               
               // Find winner
               const votesData = roundData.votes || {};
               let maxVotes = 0;
               let winnerIndex = 0;
               
               for (let i in votesData) {
                   if (votesData[i] > maxVotes) {
                       maxVotes = votesData[i];
                       winnerIndex = parseInt(i);
                   }
               }
               
               const winner = roundData.animals[winnerIndex];
               if (winner) {
                   winner.votes = maxVotes;
                   winner.round = roundData.roundNumber;
                   
                   // Save winner
                   database.ref('winners').push({
                       ...winner,
                       timestamp: Date.now()
                   });
                   
                   // Mark round as completed
                   roundRef.update({
                       status: 'completed',
                       winner: winner,
                       endTime: Date.now()
                   });
                   
                   // Update current round status
                   database.ref('currentRound').update({
                       status: 'completed'
                   });
                   
                   // Show results to all users
                   showResults(winner);
                   updateWinnersMenu();
                   
                   // Start next round after 30 seconds
                   setTimeout(() => {
                       checkForNewRound();
                   }, 30000);
               }
           });
       }

       function startNewRound() {
           // This is now just for the "Next Round" button
           checkForNewRound();
       }

       // Monitor current round changes
       function setupRoundMonitoring() {
           database.ref('currentRound').on('value', (snapshot) => {
               const currentRoundData = snapshot.val();
               
               if (currentRoundData && currentRoundData.status === 'completed') {
                   // Round has ended, show results
                   database.ref('rounds').child(currentRoundData.roundId).once('value', (roundSnapshot) => {
                       const roundData = roundSnapshot.val();
                       if (roundData && roundData.winner) {
                           showResults(roundData.winner);
                           updateWinnersMenu();
                       }
                   });
               } else if (currentRoundData && currentRoundData.status === 'active') {
                   // New round started
                   if (!isInitializing) {
                       currentRoundRef = database.ref('rounds').child(currentRoundData.roundId);
                       currentRoundRef.once('value', (roundSnapshot) => {
                           displayRound(roundSnapshot.val());
                       });
                   }
               }
           });
       }

       // Initialize
       window.onload = function() {
           console.log("Animalympics voting platform initialized!");
           
           // Load winners for menu
           updateWinnersMenu();
           
           // Setup round monitoring
           setupRoundMonitoring();
           
           // Check for current round
           checkForNewRound();
       };
   </script>
</body>
</html>

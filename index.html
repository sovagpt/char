<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animalympics - Vote for Your Champion</title>
    
    <!-- Custom Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            background: #0A0B0D;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        /* Subtle gradient background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 119, 168, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(255, 185, 103, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Grid pattern overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        .main-container {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo {
            max-width: 400px;
            width: 100%;
            height: auto;
            filter: drop-shadow(0 10px 40px rgba(0,0,0,0.5));
        }

        .tagline {
            font-size: 1.125rem;
            color: #9CA3AF;
            font-weight: 500;
            letter-spacing: -0.02em;
            margin-top: 20px;
        }

        .timer-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px 48px;
            margin-bottom: 48px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        .timer {
            color: #FFFFFF;
            font-family: 'Space Grotesk', monospace;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.02em;
        }

        .timer-label {
            font-size: 0.875rem;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .timer-value {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 32px;
            margin-bottom: 48px;
            padding: 0 20px;
        }

        .animal-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out both;
            position: relative;
        }

        .animal-card:nth-child(1) { animation-delay: 0.1s; }
        .animal-card:nth-child(2) { animation-delay: 0.2s; }
        .animal-card:nth-child(3) { animation-delay: 0.3s; }

        .animal-card:hover {
            transform: translateY(-8px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .animal-card.voted {
            border-color: #FFB967;
            background: rgba(255, 185, 103, 0.05);
        }

        .animal-card.voted::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FFB967 0%, #FF77A8 100%);
        }

        .animal-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .animal-content {
            padding: 32px;
        }

        .animal-type-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #9CA3AF;
            padding: 6px 16px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .animal-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #FFFFFF;
            letter-spacing: -0.02em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .animal-description {
            color: #9CA3AF;
            line-height: 1.6;
            margin-bottom: 24px;
            font-size: 0.95rem;
            min-height: 80px;
        }

        .vote-section {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding-top: 24px;
        }

        .vote-count {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            color: #FFFFFF;
            font-size: 1.125rem;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', monospace;
            letter-spacing: -0.01em;
        }

        .voted .vote-count {
            background: linear-gradient(135deg, rgba(255, 185, 103, 0.1), rgba(255, 119, 168, 0.1));
            border-color: rgba(255, 185, 103, 0.3);
        }

        .vote-button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .vote-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .vote-button:hover::before {
            left: 100%;
        }

        .vote-button:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 185, 103, 0.3);
        }

        .voted .vote-button {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .voted .vote-button::after {
            content: " ✓";
        }

        .more-info-button {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: transparent;
            color: #9CA3AF;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .more-info-button:hover {
            background: rgba(255, 255, 255, 0.03);
            color: #FFFFFF;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .results-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 48px;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }

        .round-winner {
            text-align: center;
            margin-bottom: 40px;
        }

        .winner-label {
            font-size: 0.875rem;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .winner-image {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            object-fit: cover;
            margin: 24px auto;
            border: 3px solid transparent;
            background: linear-gradient(#0A0B0D, #0A0B0D) padding-box,
                        linear-gradient(135deg, #FFB967 0%, #FF77A8 100%) border-box;
        }

        .winner-name {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.03em;
        }

        .winner-votes {
            font-size: 1.25rem;
            color: #9CA3AF;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .winner-description {
            color: #6B7280;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto 24px;
        }

        .next-round-btn {
            width: 100%;
            padding: 18px;
            margin-top: 32px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .next-round-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(255, 185, 103, 0.3);
        }

        .history {
            margin-top: 48px;
            padding-top: 48px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history h3 {
            color: #FFFFFF;
            margin-bottom: 24px;
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .history-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .history-animal {
            display: flex;
            align-items: center;
            gap: 16px;
            color: #FFFFFF;
            font-weight: 600;
        }

        .history-image {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            object-fit: cover;
        }

        .history-round {
            font-weight: 600;
            color: #FFB967;
            font-family: 'Space Grotesk', monospace;
        }

        /* Winners Menu Styles */
        .winners-menu {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 1000;
            max-width: 420px;
        }

        .winners-toggle {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #FFFFFF;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winners-toggle:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .winners-badge {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .winners-panel {
            position: absolute;
            bottom: 70px;
            left: 0;
            background: rgba(17, 18, 23, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            width: 420px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .winners-panel.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .winners-panel-header {
            background: linear-gradient(135deg, rgba(255, 185, 103, 0.1), rgba(255, 119, 168, 0.1));
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 24px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .winners-panel-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #FFFFFF;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winners-list {
            padding: 16px;
        }

        .winner-entry {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .winner-entry:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .winner-entry-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .winner-entry-image {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            object-fit: cover;
        }

        .winner-entry-info {
            flex: 1;
        }

        .winner-entry-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 4px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .winner-entry-round {
            color: #9CA3AF;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .winner-entry-votes {
            background: linear-gradient(135deg, #FFB967 0%, #FF77A8 100%);
            color: #0A0B0D;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.875rem;
            font-family: 'Space Grotesk', monospace;
        }

        .winner-entry-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .winner-entry-competitors {
            font-size: 0.875rem;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .competitor-name {
            display: inline-block;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 4px 8px;
            border-radius: 6px;
            margin: 2px;
            font-size: 0.75rem;
            color: #9CA3AF;
        }

        .winner-entry-time {
            font-size: 0.75rem;
            color: #6B7280;
            margin-top: 8px;
        }

        .no-winners {
            text-align: center;
            padding: 40px;
            color: #6B7280;
        }

        /* Loading states */
        .loading {
            color: #9CA3AF;
            font-size: 1.25rem;
            text-align: center;
            padding: 60px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .logo {
                max-width: 300px;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
                padding: 0;
            }
            
            .animal-card {
                max-width: 100%;
            }

            .winners-menu {
                left: 12px;
                bottom: 12px;
            }
            
            .winners-panel {
                width: calc(100vw - 40px);
                max-width: 420px;
            }

            .winner-name {
                font-size: 2rem;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="logo-container">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/689d3129ec968a3a68837590_Animalympics-14-08-2025.png" alt="Animalympics" class="logo">
            </div>
            <p class="tagline">Vote for your champion • New round every 10 minutes</p>
        </div>

        <div class="timer-container">
            <div class="timer">
                <span class="timer-label">Next Round</span>
                <span class="timer-value" id="timer">10:00</span>
            </div>
        </div>

        <div id="voting-area">
            <div class="cards-container" id="cards-container"></div>
        </div>

        <div id="results-area" style="display: none;">
            <div class="results-container">
                <div class="round-winner">
                    <div class="winner-label">Champion of Round <span id="round-number"></span></div>
                    <img class="winner-image" id="winner-image" src="" alt="">
                    <div class="winner-name" id="winner-name"></div>
                    <div class="winner-votes" id="winner-votes"></div>
                    <div class="winner-description" id="winner-description"></div>
                </div>
                <button class="next-round-btn" onclick="startNewRound()">Next Round</button>
                <div class="history" id="history">
                    <h3>Previous Champions</h3>
                </div>
            </div>
        </div>

        <!-- Winners Menu -->
        <div class="winners-menu">
            <button class="winners-toggle" onclick="toggleWinnersMenu()">
                Hall of Fame
                <span class="winners-badge" id="winners-count">0</span>
            </button>
            <div class="winners-panel" id="winners-panel">
                <div class="winners-panel-header">
                    <div class="winners-panel-title">Champions Archive</div>
                </div>
                <div class="winners-list" id="winners-list">
                    <div class="no-winners">No champions yet. Cast your votes!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCzcVwv8qs3eUny79eLIsqPu3cyybbDnuA",
            authDomain: "animal-voting.firebaseapp.com",
            databaseURL: "https://animal-voting-default-rtdb.firebaseio.com",
            projectId: "animal-voting",
            storageBucket: "animal-voting.firebasestorage.app",
            messagingSenderId: "606364151440",
            appId: "1:606364151440:web:ac16809e27f242e77fb215",
            measurementId: "G-WXCXYQH30F"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Animal data pool
        const animalPool = [
            {
                name: "Batman",
                type: "Cat",
                description: "A mysterious and charming feline who loves to patrol the sanctuary at night. Despite his tough name, he's incredibly gentle.",
                image: "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-batman"
            },
            {
                name: "Blueberry",
                type: "Rabbit",
                description: "This adorable bunny got her name from her love of fresh berries. She's playful and loves to hop around in the grass.",
                image: "https://images.unsplash.com/photo-1535241749838-299277b6305f?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-blueberry"
            },
            {
                name: "Brussels Sprout",
                type: "Guinea Pig",
                description: "Don't let the veggie name fool you - this little guy has a huge personality and loves cuddles more than anything.",
                image: "https://images.unsplash.com/photo-1548767797-d8c844163c4c?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-brussels-sprout"
            },
            {
                name: "Bryce",
                type: "Dog",
                description: "A loyal companion who came to the sanctuary after being found as a stray. He's learning to trust again and loves belly rubs.",
                image: "https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-bryce"
            },
            {
                name: "Caboodle",
                type: "Dog",
                description: "Kit's brother who has a neurological condition but doesn't let it slow him down. Loves playing with friends and rolling in snow.",
                image: "https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-caboodle"
            },
            {
                name: "Cameo",
                type: "Pig",
                description: "A gentle, affectionate pig who loves mud baths and lazy afternoons. Found as a stray in 2013, now living her best life.",
                image: "https://images.unsplash.com/photo-1516467508483-a7212febe31a?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-cameo"
            },
            {
                name: "Captain",
                type: "Dog",
                description: "Leading his pack with courage and kindness. This brave pup overcame a difficult past and now helps other dogs feel safe.",
                image: "https://images.unsplash.com/photo-1552053831-71594a27632d?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-captain"
            },
            {
                name: "Clancy",
                type: "Cat",
                description: "An Irish charmer with emerald eyes and a purr that could melt hearts. Loves sunny windowsills and head scratches.",
                image: "https://images.unsplash.com/photo-1573865526739-10659fec78a5?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-clancy"
            },
            {
                name: "Dean Martin",
                type: "Dog",
                description: "Smooth as his namesake, this crooner loves to 'sing' along when music plays. A true entertainer at heart.",
                image: "https://images.unsplash.com/photo-1477884213360-7e9d7dcc1e48?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-dean-martin"
            },
            {
                name: "Hudson",
                type: "Cat",
                description: "Has cerebellar hypoplasia but doesn't let it stop him. This special needs kitty is full of love and determination.",
                image: "https://images.unsplash.com/photo-1519052537078-e6302a4968d4?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-hudson"
            },
            {
                name: "Jelly Bean",
                type: "Cat",
                description: "A clever kitty with a mild neurological condition and deafness, but she's learned to navigate the world in her own special way.",
                image: "https://images.unsplash.com/photo-1478098711619-5ab0b478d6e6?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-jelly-bean"
            },
            {
                name: "Jewel",
                type: "Horse",
                description: "A precious gem of the sanctuary, this gentle mare loves carrots and gentle brushing sessions with volunteers.",
                image: "https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-jewel"
            },
            {
                name: "Kit",
                type: "Dog",
                description: "Sweet as can be despite her neurological challenges. Loves playing with dog friends and has an incredible spirit.",
                image: "https://images.unsplash.com/photo-1561037404-61cd46aa615b?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-kit"
            },
            {
                name: "Koda",
                type: "Cat",
                description: "Quirky and affectionate, loves perching on shoulders and zooming through cat tunnels. Not a fan of loud noises but loves hugs.",
                image: "https://images.unsplash.com/photo-1511044568932-338cba0ad803?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-koda"
            },
            {
                name: "Reindeer",
                type: "Cat",
                description: "A former mom cat learning to trust people again. First at the door to say hello despite being fearful. Full-figured and fabulous.",
                image: "https://images.unsplash.com/photo-1494256997604-768d1f608cac?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-reindeer"
            },
            {
                name: "Snickers",
                type: "Horse",
                description: "Sweet as the candy bar she's named after. This beautiful horse loves trail rides and making new human friends.",
                image: "https://images.unsplash.com/photo-1534278931827-8a259344abe7?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-snickers"
            },
            {
                name: "Tony",
                type: "Horse",
                description: "A gentle giant with a heart of gold. Tony loves apples and has become a favorite among sanctuary visitors.",
                image: "https://images.unsplash.com/photo-1450052590821-8bf91254a353?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-tony"
            },
            {
                name: "Bossco",
                type: "Dog",
                description: "Has a collapsed trachea but doesn't let it dim his spirit. This brave little guy needs special care but gives endless love.",
                image: "https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=400&h=300&fit=crop",
                link: "https://gifts.bestfriends.org/products/sponsor-bossco"
            }
        ];

        let currentAnimals = [];
        let usedAnimals = [];
        let votes = {};
        let timer = 600; // 10 minutes in seconds
        let timerInterval;
        let roundNumber = 1;
        let winners = [];
        let hasVoted = false;
        let currentRoundRef = null;
        let allRoundData = []; // Store complete round data

        function toggleWinnersMenu() {
            const panel = document.getElementById('winners-panel');
            panel.classList.toggle('active');
        }

        // Close winners menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.querySelector('.winners-menu');
            const panel = document.getElementById('winners-panel');
            if (!menu.contains(event.target) && panel.classList.contains('active')) {
                panel.classList.remove('active');
            }
        });

        function getRandomAnimals() {
            // Reset used animals if we've gone through all
            if (usedAnimals.length >= animalPool.length - 3) {
                usedAnimals = [];
            }

            const available = animalPool.filter(animal => 
                !usedAnimals.some(used => used.name === animal.name)
            );

            const shuffled = [...available].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, 3);
            
            usedAnimals.push(...selected);
            return selected;
        }

        function createAnimalCard(animal, index) {
            const card = document.createElement('div');
            card.className = 'animal-card';
            card.id = `animal-${index}`;
            
            card.innerHTML = `
                <img src="${animal.image}" alt="${animal.name}" class="animal-image">
                <div class="animal-content">
                    <span class="animal-type-badge">${animal.type}</span>
                    <div class="animal-name">${animal.name}</div>
                    <div class="animal-description">${animal.description}</div>
                    <div class="vote-section">
                        <div class="vote-count">Votes: <span id="votes-${index}">0</span></div>
                        <button class="vote-button" onclick="vote(${index})">Vote for ${animal.name}</button>
                        <a href="${animal.link}" target="_blank" rel="noopener noreferrer" class="more-info-button">
                            Learn More
                        </a>
                    </div>
                </div>
            `;
            
            return card;
        }

        function vote(index) {
            if (hasVoted) {
                alert("You've already voted in this round! Wait for the next round to vote again.");
                return;
            }
            
            votes[index] = (votes[index] || 0) + 1;
            
            // Update local display
            document.getElementById(`votes-${index}`).textContent = votes[index];
            
            // Update Firebase
            if (currentRoundRef) {
                currentRoundRef.child('votes').child(index).set(votes[index]);
                currentRoundRef.child('animals').child(index).update({
                    voteCount: votes[index]
                });
            }
            
            // Mark as voted
            document.querySelectorAll('.animal-card').forEach(card => {
                card.classList.remove('voted');
            });
            document.getElementById(`animal-${index}`).classList.add('voted');
            
            hasVoted = true;
        }

        function updateTimer() {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timer <= 0) {
                endRound();
            } else {
                timer--;
            }
        }

        function endRound() {
            clearInterval(timerInterval);
            
            // Find winner
            let maxVotes = 0;
            let winnerIndex = 0;
            for (let i in votes) {
                if (votes[i] > maxVotes) {
                    maxVotes = votes[i];
                    winnerIndex = i;
                }
            }
            
            const winner = currentAnimals[winnerIndex];
            winner.votes = maxVotes;
            winner.round = roundNumber;
            
            // Store complete round data
            const roundData = {
                round: roundNumber,
                winner: winner,
                competitors: currentAnimals,
                allVotes: {...votes},
                timestamp: new Date().toLocaleString()
            };
            
            winners.push(winner);
            allRoundData.push(roundData);
            
            // Save winner to Firebase
            if (currentRoundRef) {
                currentRoundRef.update({
                    winner: winner,
                    endTime: Date.now(),
                    status: 'completed'
                });
                
                // Save to winners collection
                database.ref('winners').push({
                    ...winner,
                    timestamp: Date.now()
                });
            }
            
            // Update winners menu
            updateWinnersMenu();
            
            // Show results
            showResults(winner);
        }

        function showResults(winner) {
            document.getElementById('voting-area').style.display = 'none';
            document.getElementById('results-area').style.display = 'block';
            
            document.getElementById('round-number').textContent = roundNumber;
            document.getElementById('winner-image').src = winner.image;
            document.getElementById('winner-name').textContent = winner.name;
            document.getElementById('winner-votes').textContent = 
                `${winner.votes} vote${winner.votes !== 1 ? 's' : ''}`;
            document.getElementById('winner-description').textContent = winner.description;
            
            updateHistory();
        }

        function updateHistory() {
            const historyContainer = document.getElementById('history');
            historyContainer.innerHTML = '<h3>Previous Champions</h3>';
            
            winners.slice(-5).reverse().forEach(winner => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-animal">
                        <img src="${winner.image}" alt="${winner.name}" class="history-image">
                        <span>${winner.name} (${winner.type})</span>
                    </div>
                    <span class="history-round">Round ${winner.round} • ${winner.votes} votes</span>
                `;
                historyContainer.appendChild(item);
            });
        }

        function updateWinnersMenu() {
            // Update badge count
            document.getElementById('winners-count').textContent = allRoundData.length;
            
            // Update winners list
            const listContainer = document.getElementById('winners-list');
            
            if (allRoundData.length === 0) {
                listContainer.innerHTML = '<div class="no-winners">No champions yet. Cast your votes!</div>';
                return;
            }
            
            listContainer.innerHTML = '';
            
            // Show all rounds in reverse order (most recent first)
            allRoundData.slice().reverse().forEach(roundData => {
                const entry = document.createElement('div');
                entry.className = 'winner-entry';
                
                // Get competitor names (excluding winner)
                const competitorNames = roundData.competitors
                    .filter(animal => animal.name !== roundData.winner.name)
                    .map(animal => `${animal.name} (${roundData.allVotes[roundData.competitors.indexOf(animal)] || 0} votes)`)
                    .join(', ');
                
                // Calculate total votes
                const totalVotes = Object.values(roundData.allVotes).reduce((sum, v) => sum + (v || 0), 0);
                
                entry.innerHTML = `
                    <div class="winner-entry-header">
                        <img src="${roundData.winner.image}" alt="${roundData.winner.name}" class="winner-entry-image">
                        <div class="winner-entry-info">
                            <div class="winner-entry-name">${roundData.winner.name}</div>
                            <div class="winner-entry-round">Round ${roundData.round}</div>
                        </div>
                        <div class="winner-entry-votes">${roundData.winner.votes} votes</div>
                    </div>
                    <div class="winner-entry-details">
                        <div class="winner-entry-competitors">
                            <strong>Competed against:</strong><br>
                            ${roundData.competitors
                                .filter(animal => animal.name !== roundData.winner.name)
                                .map(animal => {
                                    const animalIndex = roundData.competitors.indexOf(animal);
                                    const animalVotes = roundData.allVotes[animalIndex] || 0;
                                    return `<span class="competitor-name">${animal.name} (${animalVotes})</span>`;
                                }).join('')}
                        </div>
                        <div class="winner-entry-time">
                            Total votes: ${totalVotes} • ${roundData.timestamp}
                        </div>
                    </div>
                `;
                
                listContainer.appendChild(entry);
            });
        }

        function startNewRound() {
            roundNumber++;
            hasVoted = false;
            votes = {};
            timer = 600;
            
            // Get new animals
            currentAnimals = getRandomAnimals();
            
            // Create Firebase round
            currentRoundRef = database.ref('rounds').push({
                roundNumber: roundNumber,
                startTime: Date.now(),
                status: 'active',
                animals: currentAnimals.map(animal => ({
                    ...animal,
                    voteCount: 0
                })),
                votes: {}
            });
            
            // Reset display
            document.getElementById('voting-area').style.display = 'block';
            document.getElementById('results-area').style.display = 'none';
            
            // Create new cards
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            currentAnimals.forEach((animal, index) => {
                container.appendChild(createAnimalCard(animal, index));
            });
            
            // Start timer
            timerInterval = setInterval(updateTimer, 1000);
        }

        // Initialize first round
        window.onload = function() {
            console.log("Animalympics voting platform initialized!");
            startNewRound();
        };
    </script>
</body>
</html>
